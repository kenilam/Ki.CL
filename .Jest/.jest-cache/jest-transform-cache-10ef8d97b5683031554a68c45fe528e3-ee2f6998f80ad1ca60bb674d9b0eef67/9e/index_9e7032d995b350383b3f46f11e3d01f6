5635d00543a7b41fa42fd80e9d519c4e
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("core-js/modules/es.symbol");

require("core-js/modules/es.array.concat");

require("core-js/modules/es.array.filter");

require("core-js/modules/es.array.for-each");

require("core-js/modules/es.array.from");

require("core-js/modules/es.array.map");

require("core-js/modules/es.object.define-properties");

require("core-js/modules/es.object.define-property");

require("core-js/modules/es.object.get-own-property-descriptor");

require("core-js/modules/es.object.get-own-property-descriptors");

require("core-js/modules/es.object.keys");

require("core-js/modules/es.string.iterator");

require("core-js/modules/web.dom-collections.for-each");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _applyDecoratedDescriptor2 = _interopRequireDefault(require("@babel/runtime/helpers/applyDecoratedDescriptor"));

var _WebGL = require("@/Component/WebGL");

var _Helper = require("@/Helper");

var _autobindDecorator = _interopRequireDefault(require("autobind-decorator"));

var _Partial = require("./Partial");

var _class;

(function () {
  var enterModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).enterModule;
  enterModule && enterModule(module);
})();

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { keys.push.apply(keys, Object.getOwnPropertySymbols(object)); } if (enumerableOnly) keys = keys.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { if (i % 2) { var source = arguments[i] != null ? arguments[i] : {}; ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(arguments[i])); } else { ownKeys(arguments[i]).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(arguments[i], key)); }); } } return target; }

var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal["default"].signature : function (a) {
  return a;
};

var PARTICLE_COUNTS = 50;
var PARTICLE_GROUP_COUNTS = 10;
var PARTICLE_RATIO = 0.002;
var ROTATION_DURATION = 10000;
var GROUPS = Array.from(new Array(PARTICLE_GROUP_COUNTS));
var CIRCLES = Array.from(new Array(PARTICLE_COUNTS));
var Visualizer = (_class =
/*#__PURE__*/
function (_PIXI$Container) {
  (0, _inherits2["default"])(Visualizer, _PIXI$Container);

  function Visualizer() {
    var _this;

    (0, _classCallCheck2["default"])(this, Visualizer);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Visualizer).call(this));
    Object.defineProperty((0, _assertThisInitialized2["default"])(_this), "rotations", {
      enumerable: true,
      writable: true,
      value: GROUPS.map(function () {
        return {
          angle: (0, _Helper.RandomNumber)({
            start: 0,
            end: 360
          })
        };
      })
    });
    Object.defineProperty((0, _assertThisInitialized2["default"])(_this), "groups", {
      enumerable: true,
      writable: true,
      value: GROUPS.map(function (value, index) {
        if (value) {
          return;
        }

        var dimension = _this.area * PARTICLE_RATIO;
        var container = new _WebGL.PIXI.Container();
        container.rotation = _this.rotations[index].angle;
        container.alpha = (index + 1) / GROUPS.length;

        _this.addChild(container);

        return CIRCLES.map(function () {
          var circle = new _Partial.Circle({
            dimension: dimension
          });
          container.addChild(circle);
          return circle;
        });
      })
    });

    _this.groups.forEach(function (circles, index) {
      if (!circles) {
        return;
      }

      var rotation = _this.rotations[index];
      _this.rotationTween = _WebGL.Tween.to(rotation, ROTATION_DURATION * (index + 1), {
        ease: _WebGL.gsap.Linear.easeNone,
        angle: 360 * (index % 2 ? -1 : 1),
        repeat: -1,
        onUpdate: _this.rotate(index)
      });
    });

    return _this;
  }

  (0, _createClass2["default"])(Visualizer, [{
    key: "update",
    value: function update(_ref) {
      var _this2 = this;

      var height = _ref.height,
          width = _ref.width,
          x = _ref.x,
          y = _ref.y,
          rest = (0, _objectWithoutProperties2["default"])(_ref, ["height", "width", "x", "y"]);
      this.groups.forEach(function (circles, index) {
        var parent = circles[0].parent;
        parent.x = x + width / 2;
        parent.y = y + height / 2;
        circles.forEach(function (circle, i) {
          circle.update(_objectSpread({}, rest, {
            height: height,
            width: width,
            dimension: _this2.area * PARTICLE_RATIO * (1 + index / 10),
            distance: _this2.area / (3 - index / 5),
            rotation: Math.PI * 2 / PARTICLE_COUNTS * i,
            x: -width / 2,
            y: -height / 2
          }));
        });
      });
    }
  }, {
    key: "reset",
    value: function reset() {
      var _ref2;

      this.rotationTween.kill();

      (_ref2 = []).concat.apply(_ref2, (0, _toConsumableArray2["default"])(this.groups)).map(function (circle) {
        circle.reset();
      });
    }
  }, {
    key: "rotate",
    value: function rotate(index) {
      var _this3 = this;

      return function () {
        var rotation = _this3.rotations[index].angle;
        var circles = _this3.groups[index];
        circles[0].parent.rotation = rotation;
        circles[(0, _Helper.RandomNumber)({
          start: 0,
          end: PARTICLE_COUNTS - 1
        })].tween();
      };
    }
  }, {
    key: "__reactstandin__regenerateByEval",
    // @ts-ignore
    value: function __reactstandin__regenerateByEval(key, code) {
      // @ts-ignore
      this[key] = eval(code);
    }
  }, {
    key: "area",
    get: function get() {
      var _window = window,
          height = _window.innerHeight,
          width = _window.innerWidth;
      return height > width ? width : height;
    }
  }]);
  return Visualizer;
}(_WebGL.PIXI.Container), ((0, _applyDecoratedDescriptor2["default"])(_class.prototype, "rotate", [_autobindDecorator["default"]], Object.getOwnPropertyDescriptor(_class.prototype, "rotate"), _class.prototype)), _class);
var _default = Visualizer;
var _default2 = _default;
exports["default"] = _default2;
;

(function () {
  var reactHotLoader = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).default;

  if (!reactHotLoader) {
    return;
  }

  reactHotLoader.register(PARTICLE_COUNTS, "PARTICLE_COUNTS", "/Users/keni.lam/Prototype/Ki.CL/project/src/View/Home/WebGL/Gallery/Visualizer/index.tsx");
  reactHotLoader.register(PARTICLE_GROUP_COUNTS, "PARTICLE_GROUP_COUNTS", "/Users/keni.lam/Prototype/Ki.CL/project/src/View/Home/WebGL/Gallery/Visualizer/index.tsx");
  reactHotLoader.register(PARTICLE_RATIO, "PARTICLE_RATIO", "/Users/keni.lam/Prototype/Ki.CL/project/src/View/Home/WebGL/Gallery/Visualizer/index.tsx");
  reactHotLoader.register(ROTATION_DURATION, "ROTATION_DURATION", "/Users/keni.lam/Prototype/Ki.CL/project/src/View/Home/WebGL/Gallery/Visualizer/index.tsx");
  reactHotLoader.register(GROUPS, "GROUPS", "/Users/keni.lam/Prototype/Ki.CL/project/src/View/Home/WebGL/Gallery/Visualizer/index.tsx");
  reactHotLoader.register(CIRCLES, "CIRCLES", "/Users/keni.lam/Prototype/Ki.CL/project/src/View/Home/WebGL/Gallery/Visualizer/index.tsx");
  reactHotLoader.register(Visualizer, "Visualizer", "/Users/keni.lam/Prototype/Ki.CL/project/src/View/Home/WebGL/Gallery/Visualizer/index.tsx");
  reactHotLoader.register(_default, "default", "/Users/keni.lam/Prototype/Ki.CL/project/src/View/Home/WebGL/Gallery/Visualizer/index.tsx");
})();

;

(function () {
  var leaveModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).leaveModule;
  leaveModule && leaveModule(module);
})();

module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzeCJdLCJuYW1lcyI6WyJQQVJUSUNMRV9DT1VOVFMiLCJQQVJUSUNMRV9HUk9VUF9DT1VOVFMiLCJQQVJUSUNMRV9SQVRJTyIsIlJPVEFUSU9OX0RVUkFUSU9OIiwiR1JPVVBTIiwiQXJyYXkiLCJmcm9tIiwiQ0lSQ0xFUyIsIlZpc3VhbGl6ZXIiLCJtYXAiLCJhbmdsZSIsInN0YXJ0IiwiZW5kIiwidmFsdWUiLCJpbmRleCIsImRpbWVuc2lvbiIsImFyZWEiLCJjb250YWluZXIiLCJQSVhJIiwiQ29udGFpbmVyIiwicm90YXRpb24iLCJyb3RhdGlvbnMiLCJhbHBoYSIsImxlbmd0aCIsImFkZENoaWxkIiwiY2lyY2xlIiwiQ2lyY2xlIiwiZ3JvdXBzIiwiZm9yRWFjaCIsImNpcmNsZXMiLCJyb3RhdGlvblR3ZWVuIiwiVHdlZW4iLCJ0byIsImVhc2UiLCJnc2FwIiwiTGluZWFyIiwiZWFzZU5vbmUiLCJyZXBlYXQiLCJvblVwZGF0ZSIsInJvdGF0ZSIsImhlaWdodCIsIndpZHRoIiwieCIsInkiLCJyZXN0IiwicGFyZW50IiwiaSIsInVwZGF0ZSIsImRpc3RhbmNlIiwiTWF0aCIsIlBJIiwia2lsbCIsImNvbmNhdCIsInJlc2V0IiwidHdlZW4iLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsImlubmVyV2lkdGgiLCJhdXRvYmluZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7OztBQUlBLElBQU1BLGVBQWUsR0FBRyxFQUF4QjtBQUNBLElBQU1DLHFCQUFxQixHQUFHLEVBQTlCO0FBQ0EsSUFBTUMsY0FBYyxHQUFHLEtBQXZCO0FBQ0EsSUFBTUMsaUJBQWlCLEdBQUcsS0FBMUI7QUFFQSxJQUFNQyxNQUFNLEdBQUdDLEtBQUssQ0FBQ0MsSUFBTixDQUFXLElBQUlELEtBQUosQ0FBVUoscUJBQVYsQ0FBWCxDQUFmO0FBQ0EsSUFBTU0sT0FBTyxHQUFHRixLQUFLLENBQUNDLElBQU4sQ0FBVyxJQUFJRCxLQUFKLENBQVVMLGVBQVYsQ0FBWCxDQUFoQjtJQUVNUSxVOzs7OztBQWlDSix3QkFBYztBQUFBOztBQUFBO0FBQ1o7QUFEWTtBQUFBO0FBQUE7QUFBQSxhQWhDb0NKLE1BQU0sQ0FBQ0ssR0FBUCxDQUFXO0FBQUEsZUFBTztBQUNsRUMsVUFBQUEsS0FBSyxFQUFFLDBCQUFhO0FBQUNDLFlBQUFBLEtBQUssRUFBRSxDQUFSO0FBQVdDLFlBQUFBLEdBQUcsRUFBRTtBQUFoQixXQUFiO0FBRDJELFNBQVA7QUFBQSxPQUFYO0FBZ0NwQztBQUFBO0FBQUE7QUFBQTtBQUFBLGFBN0J3QlIsTUFBTSxDQUFDSyxHQUFQLENBQ3BDLFVBQUNJLEtBQUQsRUFBUUMsS0FBUixFQUFrQjtBQUNoQixZQUFJRCxLQUFKLEVBQVc7QUFDVDtBQUNEOztBQUVELFlBQU1FLFNBQVMsR0FBRyxNQUFLQyxJQUFMLEdBQVlkLGNBQTlCO0FBRUEsWUFBTWUsU0FBUyxHQUFHLElBQUlDLFlBQUtDLFNBQVQsRUFBbEI7QUFFQUYsUUFBQUEsU0FBUyxDQUFDRyxRQUFWLEdBQXFCLE1BQUtDLFNBQUwsQ0FBZVAsS0FBZixFQUFzQkosS0FBM0M7QUFDQU8sUUFBQUEsU0FBUyxDQUFDSyxLQUFWLEdBQWtCLENBQUNSLEtBQUssR0FBRyxDQUFULElBQWNWLE1BQU0sQ0FBQ21CLE1BQXZDOztBQUVBLGNBQUtDLFFBQUwsQ0FBY1AsU0FBZDs7QUFFQSxlQUFPVixPQUFPLENBQUNFLEdBQVIsQ0FDTCxZQUFNO0FBQ0osY0FBTWdCLE1BQU0sR0FBRyxJQUFJQyxlQUFKLENBQVc7QUFBRVgsWUFBQUEsU0FBUyxFQUFUQTtBQUFGLFdBQVgsQ0FBZjtBQUVBRSxVQUFBQSxTQUFTLENBQUNPLFFBQVYsQ0FBbUJDLE1BQW5CO0FBRUEsaUJBQU9BLE1BQVA7QUFDRCxTQVBJLENBQVA7QUFTRCxPQXhCbUM7QUE2QnhCOztBQUdaLFVBQUtFLE1BQUwsQ0FBWUMsT0FBWixDQUNFLFVBQUNDLE9BQUQsRUFBVWYsS0FBVixFQUFvQjtBQUNsQixVQUFJLENBQUNlLE9BQUwsRUFBYztBQUNaO0FBQ0Q7O0FBRUQsVUFBTVQsUUFBUSxHQUFHLE1BQUtDLFNBQUwsQ0FBZVAsS0FBZixDQUFqQjtBQUVBLFlBQUtnQixhQUFMLEdBQXFCQyxhQUFNQyxFQUFOLENBQVNaLFFBQVQsRUFBbUJqQixpQkFBaUIsSUFBSVcsS0FBSyxHQUFHLENBQVosQ0FBcEMsRUFBb0Q7QUFDdkVtQixRQUFBQSxJQUFJLEVBQUVDLFlBQUtDLE1BQUwsQ0FBWUMsUUFEcUQ7QUFFdkUxQixRQUFBQSxLQUFLLEVBQUUsT0FBT0ksS0FBSyxHQUFHLENBQVIsR0FBWSxDQUFDLENBQWIsR0FBaUIsQ0FBeEIsQ0FGZ0U7QUFHdkV1QixRQUFBQSxNQUFNLEVBQUUsQ0FBQyxDQUg4RDtBQUl2RUMsUUFBQUEsUUFBUSxFQUFFLE1BQUtDLE1BQUwsQ0FBWXpCLEtBQVo7QUFKNkQsT0FBcEQsQ0FBckI7QUFNRCxLQWRIOztBQUhZO0FBbUJiOzs7O2lDQVdzRTtBQUFBOztBQUFBLFVBQXhEMEIsTUFBd0QsUUFBeERBLE1BQXdEO0FBQUEsVUFBaERDLEtBQWdELFFBQWhEQSxLQUFnRDtBQUFBLFVBQXpDQyxDQUF5QyxRQUF6Q0EsQ0FBeUM7QUFBQSxVQUF0Q0MsQ0FBc0MsUUFBdENBLENBQXNDO0FBQUEsVUFBaENDLElBQWdDO0FBQ3JFLFdBQUtqQixNQUFMLENBQVlDLE9BQVosQ0FDRSxVQUFDQyxPQUFELEVBQVVmLEtBQVYsRUFBb0I7QUFDbEIsWUFBTStCLE1BQU0sR0FBR2hCLE9BQU8sQ0FBQyxDQUFELENBQVAsQ0FBV2dCLE1BQTFCO0FBRUFBLFFBQUFBLE1BQU0sQ0FBQ0gsQ0FBUCxHQUFXQSxDQUFDLEdBQUdELEtBQUssR0FBRyxDQUF2QjtBQUNBSSxRQUFBQSxNQUFNLENBQUNGLENBQVAsR0FBV0EsQ0FBQyxHQUFHSCxNQUFNLEdBQUcsQ0FBeEI7QUFFQVgsUUFBQUEsT0FBTyxDQUFDRCxPQUFSLENBQ0UsVUFBQ0gsTUFBRCxFQUFTcUIsQ0FBVCxFQUFlO0FBQ2JyQixVQUFBQSxNQUFNLENBQUNzQixNQUFQLG1CQUNLSCxJQURMO0FBRUVKLFlBQUFBLE1BQU0sRUFBTkEsTUFGRjtBQUdFQyxZQUFBQSxLQUFLLEVBQUxBLEtBSEY7QUFJRTFCLFlBQUFBLFNBQVMsRUFBRSxNQUFJLENBQUNDLElBQUwsR0FBWWQsY0FBWixJQUE4QixJQUFJWSxLQUFLLEdBQUcsRUFBMUMsQ0FKYjtBQUtFa0MsWUFBQUEsUUFBUSxFQUFFLE1BQUksQ0FBQ2hDLElBQUwsSUFBYSxJQUFLRixLQUFLLEdBQUcsQ0FBMUIsQ0FMWjtBQU1FTSxZQUFBQSxRQUFRLEVBQUU2QixJQUFJLENBQUNDLEVBQUwsR0FBVSxDQUFWLEdBQWNsRCxlQUFkLEdBQWdDOEMsQ0FONUM7QUFPRUosWUFBQUEsQ0FBQyxFQUFFLENBQUNELEtBQUQsR0FBUyxDQVBkO0FBUUVFLFlBQUFBLENBQUMsRUFBRSxDQUFDSCxNQUFELEdBQVU7QUFSZjtBQVVELFNBWkg7QUFjRCxPQXJCSDtBQXVCRDs7OzRCQUVjO0FBQUE7O0FBQ2IsV0FBS1YsYUFBTCxDQUFtQnFCLElBQW5COztBQUVBLG1CQUFHQyxNQUFILGtEQUFhLEtBQUt6QixNQUFsQixHQUEwQmxCLEdBQTFCLENBQ0UsVUFBQ2dCLE1BQUQsRUFBb0I7QUFDbEJBLFFBQUFBLE1BQU0sQ0FBQzRCLEtBQVA7QUFDRCxPQUhIO0FBS0Q7OzsyQkFHY3ZDLEssRUFBZTtBQUFBOztBQUM1QixhQUFPLFlBQU07QUFDWCxZQUFNTSxRQUFRLEdBQUcsTUFBSSxDQUFDQyxTQUFMLENBQWVQLEtBQWYsRUFBc0JKLEtBQXZDO0FBQ0EsWUFBTW1CLE9BQU8sR0FBRyxNQUFJLENBQUNGLE1BQUwsQ0FBWWIsS0FBWixDQUFoQjtBQUVBZSxRQUFBQSxPQUFPLENBQUMsQ0FBRCxDQUFQLENBQVdnQixNQUFYLENBQWtCekIsUUFBbEIsR0FBNkJBLFFBQTdCO0FBQ0FTLFFBQUFBLE9BQU8sQ0FBQywwQkFBYTtBQUFDbEIsVUFBQUEsS0FBSyxFQUFFLENBQVI7QUFBV0MsVUFBQUEsR0FBRyxFQUFFWixlQUFlLEdBQUc7QUFBbEMsU0FBYixDQUFELENBQVAsQ0FBNERzRCxLQUE1RDtBQUNELE9BTkQ7QUFPRDs7Ozs7Ozs7Ozt3QkF0RGtCO0FBQUEsb0JBSWJDLE1BSmE7QUFBQSxVQUVGZixNQUZFLFdBRWZnQixXQUZlO0FBQUEsVUFHSGYsS0FIRyxXQUdmZ0IsVUFIZTtBQU1qQixhQUFPakIsTUFBTSxHQUFHQyxLQUFULEdBQWlCQSxLQUFqQixHQUF5QkQsTUFBaEM7QUFDRDs7O0VBN0RzQnRCLFlBQUtDLFMsNEVBbUczQnVDLDZCO2VBWVlsRCxVOzs7Ozs7Ozs7Ozs7MEJBdkhUUixlOzBCQUNBQyxxQjswQkFDQUMsYzswQkFDQUMsaUI7MEJBRUFDLE07MEJBQ0FHLE87MEJBRUFDLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2dzYXAsIFBJWEksIFR3ZWVufSBmcm9tICdAL0NvbXBvbmVudC9XZWJHTCc7XG5pbXBvcnQge1JhbmRvbU51bWJlcn0gZnJvbSAnQC9IZWxwZXInO1xuaW1wb3J0IGF1dG9iaW5kIGZyb20gJ2F1dG9iaW5kLWRlY29yYXRvcic7XG5pbXBvcnQge0NpcmNsZX0gZnJvbSAnLi9QYXJ0aWFsJztcblxuaW1wb3J0IElWaXN1YWxpemVyIGZyb20gJy4vc3BlYyc7XG5cbmNvbnN0IFBBUlRJQ0xFX0NPVU5UUyA9IDUwO1xuY29uc3QgUEFSVElDTEVfR1JPVVBfQ09VTlRTID0gMTA7XG5jb25zdCBQQVJUSUNMRV9SQVRJTyA9IDAuMDAyO1xuY29uc3QgUk9UQVRJT05fRFVSQVRJT04gPSAxMDAwMDtcblxuY29uc3QgR1JPVVBTID0gQXJyYXkuZnJvbShuZXcgQXJyYXkoUEFSVElDTEVfR1JPVVBfQ09VTlRTKSk7XG5jb25zdCBDSVJDTEVTID0gQXJyYXkuZnJvbShuZXcgQXJyYXkoUEFSVElDTEVfQ09VTlRTKSk7XG5cbmNsYXNzIFZpc3VhbGl6ZXIgZXh0ZW5kcyBQSVhJLkNvbnRhaW5lciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgcm90YXRpb25zOiB7IGFuZ2xlOiBudW1iZXIgfVtdID0gR1JPVVBTLm1hcCgoKSA9PiAoe1xuICAgIGFuZ2xlOiBSYW5kb21OdW1iZXIoe3N0YXJ0OiAwLCBlbmQ6IDM2MH0pXG4gIH0pKTtcbiAgcHJpdmF0ZSByZWFkb25seSBncm91cHM6IENpcmNsZVtdW10gPSBHUk9VUFMubWFwKFxuICAgICh2YWx1ZSwgaW5kZXgpID0+IHtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGRpbWVuc2lvbiA9IHRoaXMuYXJlYSAqIFBBUlRJQ0xFX1JBVElPO1xuICAgICAgXG4gICAgICBjb25zdCBjb250YWluZXIgPSBuZXcgUElYSS5Db250YWluZXIoKTtcbiAgICAgIFxuICAgICAgY29udGFpbmVyLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbnNbaW5kZXhdLmFuZ2xlO1xuICAgICAgY29udGFpbmVyLmFscGhhID0gKGluZGV4ICsgMSkgLyBHUk9VUFMubGVuZ3RoO1xuICAgICAgXG4gICAgICB0aGlzLmFkZENoaWxkKGNvbnRhaW5lcik7XG4gICAgICBcbiAgICAgIHJldHVybiBDSVJDTEVTLm1hcChcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGNpcmNsZSA9IG5ldyBDaXJjbGUoeyBkaW1lbnNpb24gfSk7XG4gIFxuICAgICAgICAgIGNvbnRhaW5lci5hZGRDaGlsZChjaXJjbGUpO1xuICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiBjaXJjbGU7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuICApO1xuICBcbiAgcHJpdmF0ZSByb3RhdGlvblR3ZWVuOiBUd2VlbjtcbiAgXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgXG4gICAgdGhpcy5ncm91cHMuZm9yRWFjaChcbiAgICAgIChjaXJjbGVzLCBpbmRleCkgPT4ge1xuICAgICAgICBpZiAoIWNpcmNsZXMpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbnNbaW5kZXhdO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5yb3RhdGlvblR3ZWVuID0gVHdlZW4udG8ocm90YXRpb24sIFJPVEFUSU9OX0RVUkFUSU9OICogKGluZGV4ICsgMSksIHtcbiAgICAgICAgICBlYXNlOiBnc2FwLkxpbmVhci5lYXNlTm9uZSxcbiAgICAgICAgICBhbmdsZTogMzYwICogKGluZGV4ICUgMiA/IC0xIDogMSksXG4gICAgICAgICAgcmVwZWF0OiAtMSxcbiAgICAgICAgICBvblVwZGF0ZTogdGhpcy5yb3RhdGUoaW5kZXgpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICk7XG4gIH1cbiAgXG4gIHByaXZhdGUgZ2V0IGFyZWEoKSB7XG4gICAgY29uc3Qge1xuICAgICAgaW5uZXJIZWlnaHQ6IGhlaWdodCxcbiAgICAgIGlubmVyV2lkdGg6IHdpZHRoXG4gICAgfSA9IHdpbmRvdztcbiAgICBcbiAgICByZXR1cm4gaGVpZ2h0ID4gd2lkdGggPyB3aWR0aCA6IGhlaWdodDtcbiAgfVxuICBcbiAgcHVibGljIHVwZGF0ZSh7aGVpZ2h0LCB3aWR0aCwgeCwgeSwgLi4ucmVzdH06IElWaXN1YWxpemVyLlVwZGF0ZVByb3BzKSB7XG4gICAgdGhpcy5ncm91cHMuZm9yRWFjaChcbiAgICAgIChjaXJjbGVzLCBpbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBjaXJjbGVzWzBdLnBhcmVudDtcbiAgICAgICAgXG4gICAgICAgIHBhcmVudC54ID0geCArIHdpZHRoIC8gMjtcbiAgICAgICAgcGFyZW50LnkgPSB5ICsgaGVpZ2h0IC8gMjtcbiAgICAgICAgXG4gICAgICAgIGNpcmNsZXMuZm9yRWFjaChcbiAgICAgICAgICAoY2lyY2xlLCBpKSA9PiB7XG4gICAgICAgICAgICBjaXJjbGUudXBkYXRlKHtcbiAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgaGVpZ2h0LFxuICAgICAgICAgICAgICB3aWR0aCxcbiAgICAgICAgICAgICAgZGltZW5zaW9uOiB0aGlzLmFyZWEgKiBQQVJUSUNMRV9SQVRJTyAqICgxICsgaW5kZXggLyAxMCksXG4gICAgICAgICAgICAgIGRpc3RhbmNlOiB0aGlzLmFyZWEgLyAoMyAtIChpbmRleCAvIDUpKSxcbiAgICAgICAgICAgICAgcm90YXRpb246IE1hdGguUEkgKiAyIC8gUEFSVElDTEVfQ09VTlRTICogaSxcbiAgICAgICAgICAgICAgeDogLXdpZHRoIC8gMixcbiAgICAgICAgICAgICAgeTogLWhlaWdodCAvIDIsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuICBcbiAgcHVibGljIHJlc2V0KCkge1xuICAgIHRoaXMucm90YXRpb25Ud2Vlbi5raWxsKCk7XG4gICAgXG4gICAgW10uY29uY2F0KC4uLnRoaXMuZ3JvdXBzKS5tYXAoXG4gICAgICAoY2lyY2xlOiBDaXJjbGUpID0+IHtcbiAgICAgICAgY2lyY2xlLnJlc2V0KCk7XG4gICAgICB9XG4gICAgKVxuICB9XG4gIFxuICBAYXV0b2JpbmRcbiAgcHJpdmF0ZSByb3RhdGUoaW5kZXg6IG51bWJlcikge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjb25zdCByb3RhdGlvbiA9IHRoaXMucm90YXRpb25zW2luZGV4XS5hbmdsZTtcbiAgICAgIGNvbnN0IGNpcmNsZXMgPSB0aGlzLmdyb3Vwc1tpbmRleF07XG4gICAgICBcbiAgICAgIGNpcmNsZXNbMF0ucGFyZW50LnJvdGF0aW9uID0gcm90YXRpb247XG4gICAgICBjaXJjbGVzW1JhbmRvbU51bWJlcih7c3RhcnQ6IDAsIGVuZDogUEFSVElDTEVfQ09VTlRTIC0gMX0pXS50d2VlbigpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBWaXN1YWxpemVyO1xuIl19